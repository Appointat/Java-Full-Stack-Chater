<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />

    <title>User Page</title>
    <link
            href="https://cdn.metroui.org.ua/current/metro.css"
            rel="stylesheet"
    />
    <link rel="stylesheet" href="/css/page_user.css" />
</head>
<body>
<header class="header">
    <h1>User Dashboard</h1>
    <a class="logout-btn" href="/signin">Logout</a>
    <nav class="main-nav">
        <ul class="main-nav-list">
            <li><a class="nav-btn" href="/page_edit">Edit my account</a></li>
            <li><a class="nav-btn" href="/chatroom">Create A Chat Room</a></li>
            <li><a class="nav-btn" href="">Something...</a></li>
        </ul>
    </nav>
</header>

<main class="main">
    <aside class="aside-info">
        <span th:text="${session.user.email}"></span>
        <form id="chatroom-form" th:action="@{/chatroom/createchatroom}" method="post">
            <div>
                <input type="hidden" id="email" name="email" th:value="${session.user.email}">
                <input type="hidden" id="create_date" name="create_date">
                <input type="hidden" id="is_admin" name="is_admin" th:value="${false}">
            </div>
            <div>
                <label for="chat_room_name">Chat Room Name:</label>
                <input type="text" id="chat_room_name" name="chat_room_name" required>
            </div>
            <div>
                <label for="description">Description:</label>
                <input type="text" id="description" name="description" required>
            </div>

            <div>
                <label for="expire_date">Expire Date:</label>
                <input type="datetime-local" id="expire_date" name="expire_date" required>
            </div>
            <div>
                <button type="submit">Create Chat Room</button>
            </div>
        </form>
    </aside>
    <!--    Room List-->
    <section class="main-section">
        <h2>Created rooms</h2>
        <table class="table" id="created-rooms">
            <tr class="table_header" >
                <td class="room-id"> ID </td>
                <td class="title">Title</td>
                <td class="description"> Description </td>
                <td class="created-date">Created Date</td>
                <td class="expired-ate">Expire Date</td>
                <td>Action</td>
            </tr>
            <tr th:each="rooms:${session.created_rooms}" class="data-row">
                <td>
                    <span th:text="${rooms.getId()}"></span>
                </td>
                <td>
                    <span th:text="${rooms.getTitle()}"></span>
                </td>
                <td>
                    <span th:text="${rooms.getDescription()}"></span>
                </td>
                <td>
                    <span th:text="${rooms.getCreatedDate()}"></span>
                </td>
                <td>
                    <span th:text="${rooms.getExpiredDate()}"></span>
                </td>

                <td>
                    <a class="btn" href="javascript:;" >Enter</a>
                    <a class="btn" href="javascript:;" >Delete</a>
                    <a class="btn" th:href="@{/chatroom/invite(id=${rooms.getId()})}">Invite</a>
                </td>
            </tr>
        </table>
        <h2>Invited rooms</h2>
        <table class="table" id="invited-rooms">
            <tr class="table_header" >
                <td class="room-id"> ID </td>
                <td class="title">Title</td>
                <td class="description"> Description </td>
                <td class="created-date">Created Date</td>
                <td class="expired-ate">Expire Date</td>
                <td>Action</td>
            </tr>
            <tr th:each="invited_rooms:${session.invited_rooms}" class="data-row">
                <td>
                    <span th:text="${invited_rooms.getId()}"></span>
                </td>
                <td>
                    <span th:text="${invited_rooms.getTitle()}"></span>
                </td>
                <td>
                    <span th:text="${invited_rooms.getDescription()}"></span>
                </td>
                <td>
                    <span th:text="${invited_rooms.getCreatedDate()}"></span>
                </td>
                <td>
                    <span th:text="${invited_rooms.getExpiredDate()}"></span>
                </td>

                <td>
                    <a class="btn" href="javascript:;" >Enter</a>
                </td>
            </tr>
        </table>
    </section>
</main>

<footer class="footer">Java Full-Stack Chatter 2024 | CHEN Zikang HOU Longhao</footer>
</body>
<script>
    document.getElementById('chatroom-form').addEventListener('submit', function(event) {
        const createDateInput = document.getElementById('create_date');
        const expireDateInput = document.getElementById('expire_date');
        const now = new Date();
        const formattedCreateDate = now.toISOString().split('.')[0]; // Format to 'YYYY-MM-DDTHH:MM:SS'
        createDateInput.value = formattedCreateDate;
        const expireDateValue = new Date(expireDateInput.value);
        if (expireDateValue <= now) {
            alert("Expire date must be after the current date and time.");
            event.preventDefault();
        }
    });
</script>
<script src="https://cdn.metroui.org.ua/current/metro.js"></script>
</html>
